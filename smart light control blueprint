blueprint:
  name: Helper + Backlight Toggle
  description: >
    Toggle a helper on button press, sync it with light state, and keep LEDs opposite of lights.
  domain: automation
  input:
    main_lights:
      name: Lights
      description: The light(s) to read for syncing the helper and LEDs
      selector:
        entity:
          domain: light
          multiple: true

    helper_entity:
      name: Helper
      description: The input_boolean to toggle or sync with the lights
      selector:
        entity:
          domain: input_boolean

    button_entities:
      name: Buttons (optional)
      description: Buttons to toggle the helper
      default: []
      selector:
        entity:
          domain: sensor
          multiple: true

    led_entities:
      name: LED Indicators (optional)
      description: Switches to set opposite of the light(s)
      default: []
      selector:
        entity:
          domain: switch
          multiple: true

trigger:
  # Button presses
  - platform: state
    entity_id: !input button_entities
    to: "press"

  # Light state changes
  - platform: state
    entity_id: !input main_lights

action:
  - choose:
      # If triggered by button → toggle helper
      - conditions:
          - condition: template
            value_template: >
              {{ trigger.entity_id in button_entities }}
        sequence:
          - service: input_boolean.toggle
            target:
              entity_id: !input helper_entity

      # If triggered by lights → sync helper
      - conditions:
          - condition: template
            value_template: >
              {{ trigger.entity_id in main_lights }}
        sequence:
          - choose:
              - conditions:
                  - condition: state
                    entity_id: !input main_lights
                    match: any
                    state: 'on'
                sequence:
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input helper_entity
              - conditions:
                  - condition: state
                    entity_id: !input main_lights
                    match: all
                    state: 'off'
                sequence:
                  - service: input_boolean.turn_off
                    target:
                      entity_id: !input helper_entity

  # Update LED indicators to be opposite of lights
  - choose:
      - conditions:
          - condition: state
            entity_id: !input main_lights
            match: any
            state: 'on'
        sequence:
          - service: switch.turn_off
            target:
              entity_id: !input led_entities
      - conditions:
          - condition: state
            entity_id: !input main_lights
            match: all
            state: 'off'
        sequence:
          - service: switch.turn_on
            target:
              entity_id: !input led_entities

mode: single
